/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */
apply plugin: 'groovy'

// 修改源码目录
sourceSets {
    main {
        groovy {
            srcDirs = ['src']
        }
    }
    test {
        groovy {
            srcDirs = ['test/src']
        }
        resources {
            srcDirs 'test/case'
        }
    }
}

//修改输出目录
buildDir = 'out'

// 本地 => 阿里源
repositories {
    mavenLocal()
    maven { url 'http://maven.aliyun.com/nexus/content/repositories/central/' }
}

// 使用groovy开发需导入
dependencies {
    compile 'org.codehaus.groovy:groovy-all:2.5.8'
}

// 自定义测试任务
task testCmdArgsCanRun(dependsOn: [compileGroovy, compileTestGroovy]) {
    group = 'my'
    description = 'test lib CmdArgs.'

    doFirst {
        String sh = 'groovy -cp out/classes/groovy/main;out/classes/groovy/test; ' +
                'test/src/TestCmdArgsCanRun.groovy ' +
                'list -date 2020-01-22 -out D:/output.txt -province 福建 浙江'
        Process process = sh.execute()
        logger.log LogLevel.ERROR, process.err.getText('gbk')
        println "testLibCmd output:\n${process.in.getText('gbk')}"
    }
}

task testIntegrationMain(dependsOn: [compileGroovy, compileTestGroovy]) {
    group = 'my'
    description = 'test province map.'

    doFirst {
        String sh = 'groovy -cp out/classes/groovy/main;out/classes/groovy/test; ' +
//                '-Duser.dir=D:\\code\\groovy\\InfectStatistic\\test\\src\\ ' +
                'test/src/TestIntegrationMain.groovy log'
        Process process = sh.execute()
        logger.log LogLevel.ERROR, process.err.getText('gbk')
        println "testProvinceMap output:\n${process.in.getText('gbk')}"
    }
}
